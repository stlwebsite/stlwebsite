<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live</title>
  <style>
    body {
      font-family: "Roboto Condensed", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f9;
      color: #333;
    }
    header {
      text-align: center;
      padding: 20px;
    }
    header img {
      max-width: 180px;
    }
    h1 {
      margin-top: 10px;
    }
    .content {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 20px;
    }
    .streams {
      flex: 2;
      min-width: 300px;
    }
    .streams iframe {
      width: 100%;
      height: 360px;
      border: none;
      margin-bottom: 15px;
    }
    .chat {
      flex: 1;
      min-width: 300px;
    }
    .chat iframe {
      width: 100%;
      height: 600px;
      border: none;
    }
  </style>
</head>
<body>
  <header>
    <a href="/"><img id="logo" alt="Logo"></a>
    <h1 id="titulo"></h1>
  </header>

  <div class="content">
    <div class="streams" id="streams"></div>
    <div class="chat" id="chat"></div>
  </div>

  <div id="ads"></div>

  <script>
    // Leer los parámetros
    const urlParams = new URLSearchParams(window.location.search);
    const encoded = urlParams.get("data");

    if (encoded) {
      const decoded = atob(encoded);
      const params = new URLSearchParams(decoded);

      // Título
      document.title = params.get("titulo") || "Live";
      document.getElementById("titulo").textContent = params.get("titulo") || "Live Stream";

      // Logo
      const logo = params.get("logo");
      if (logo) document.getElementById("logo").src = logo;

      // Streams
      const streamsContainer = document.getElementById("streams");
      for (let i = 1; i <= 6; i++) {
        const url = params.get(`stream-url${i}`);
        if (url) {
          const name = params.get(`name${i}`) || `Stream ${i}`;
          const sandbox = params.get(`sandbox${i}`) !== null; // si existe, está checked
          const iframe = document.createElement("iframe");
          iframe.src = url;
          if (sandbox) iframe.setAttribute("sandbox", "allow-scripts allow-same-origin allow-forms allow-popups");
          streamsContainer.appendChild(iframe);
        }
      }

      // Chat
      const chatUser = params.get("chat");
      const platform = params.get("platform");
      if (chatUser && platform) {
        let chatEmbed = "";
        if (platform === "twitch") {
          chatEmbed = `<iframe src="https://www.twitch.tv/embed/${chatUser}/chat?parent=${location.hostname}"></iframe>`;
        } else if (platform === "youtube") {
          chatEmbed = `<iframe src="https://www.youtube.com/live_chat?v=${chatUser}&embed_domain=${location.hostname}"></iframe>`;
        } else if (platform === "kick") {
          chatEmbed = `<iframe src="https://kick.com/${chatUser}/chatroom"></iframe>`;
        }
        document.getElementById("chat").innerHTML = chatEmbed;
      }

      // Ads (inserta script directamente)
      const adsCode = params.get("script");
      if (adsCode) {
        const adsDiv = document.getElementById("ads");
        adsDiv.innerHTML = adsCode;
      }
    } else {
      document.body.innerHTML = "<h2>No se recibieron datos</h2>";
    }
  </script>
</body>
</html>
