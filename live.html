<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Stream Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
            font-family: "Roboto Condensed", sans-serif;
            background-color: #000;
        }
        .columna { padding: 0; box-sizing: border-box; }
        .columna-80 { flex: 0 0 75%; }
        .columna-20 { flex: 0 0 25%; height: 100vh; }
        @media (max-width: 768px) { .columna-80, .columna-20 { flex: 0 0 100%; } }
        .iframe-container { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; }
        .iframe-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .buttons-container { display: flex; flex-wrap: wrap; margin-top:5px; }
        .buttons-container button { margin: 2px; padding: 5px 15px; background-color: #e41d25; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        .buttons-container button:hover { background-color: #0056b3; }
    </style>
</head>
<body>
    <div class="columna columna-80">
        <div class="iframe-container"></div>
        <div id="link" class="buttons-container" style="float:right;"></div>
    </div>

    <div class="columna columna-20">
        <iframe id="chat_embed" frameborder="0" scrolling="no" height="100%" width="100%"></iframe>
    </div>

    <script>
        // Decodifica base64 de parámetros GET
        function decodeBase64Params(str){
            const decoded = atob(str);
            return new URLSearchParams(decoded);
        }

        // Obtiene parámetro de URL
        function getParameterByName(name){
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Crea iframe principal
        function createPlayer(url){
            const container = document.querySelector('.iframe-container');
            container.innerHTML = '';
            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.frameBorder = 0;
            iframe.width = '100%';
            iframe.height = '100%';
            container.appendChild(iframe);
        }

        // Configura chat según plataforma
        function createChat(platform, user){
            const domain = window.location.hostname;
            let chatSrc = '';
            if(platform === 'youtube') chatSrc = `https://www.youtube.com/live_chat?v=${user}&embed_domain=${domain}`;
            else if(platform === 'twitch') chatSrc = `https://www.twitch.tv/embed/${user}/chat?parent=${domain}`;
            else if(platform === 'kick') chatSrc = `https://kick.com/${user}/chatroom?embed_domain=${domain}`;
            if(chatSrc) document.getElementById('chat_embed').src = chatSrc;
            else document.getElementById('chat_embed').srcdoc = '<p style="color:white;">Chat no disponible</p>';
        }

        // Botón para copiar link
        function createShareButton(base64){
            const container = document.getElementById('link');
            const btn = document.createElement('button');
            btn.textContent = 'Copiar link';
            btn.onclick = async () => {
                const url = `${window.location.origin}${window.location.pathname}?get=${base64}`;
                try { await navigator.clipboard.writeText(url); alert('Link copiado: ' + url); }
                catch(e){ alert('Error copiando link'); }
            };
            container.appendChild(btn);
        }

        // Carga todo
        window.onload = function(){
            const encoded = getParameterByName('get');
            if(!encoded) return;

            const params = decodeBase64Params(encoded);
            const playerUrl = params.get('player'); // URL del iframe
            const chatPlatform = params.get('platform'); // youtube, twitch, kick
            const chatUser = params.get('chat'); // ID o usuario del chat
            const title = params.get('titulo');

            if(title) document.title = title;

            if(playerUrl) createPlayer(playerUrl);
            if(chatPlatform && chatUser) createChat(chatPlatform, chatUser);
            createShareButton(encoded);
        }
    </script>
</body>
</html>
